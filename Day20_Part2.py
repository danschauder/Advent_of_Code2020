import re, math
import numpy as np
# input="""Tile 2311:
# ..##.#..#.
# ##..#.....
# #...##..#.
# ####.#...#
# ##.##.###.
# ##...#.###
# .#.#.#..##
# ..#....#..
# ###...#.#.
# ..###..###

# Tile 1951:
# #.##...##.
# #.####...#
# .....#..##
# #...######
# .##.#....#
# .###.#####
# ###.##.##.
# .###....#.
# ..#.#..#.#
# #...##.#..

# Tile 1171:
# ####...##.
# #..##.#..#
# ##.#..#.#.
# .###.####.
# ..###.####
# .##....##.
# .#...####.
# #.##.####.
# ####..#...
# .....##...

# Tile 1427:
# ###.##.#..
# .#..#.##..
# .#.##.#..#
# #.#.#.##.#
# ....#...##
# ...##..##.
# ...#.#####
# .#.####.#.
# ..#..###.#
# ..##.#..#.

# Tile 1489:
# ##.#.#....
# ..##...#..
# .##..##...
# ..#...#...
# #####...#.
# #..#.#.#.#
# ...#.#.#..
# ##.#...##.
# ..##.##.##
# ###.##.#..

# Tile 2473:
# #....####.
# #..#.##...
# #.##..#...
# ######.#.#
# .#...#.#.#
# .#########
# .###.#..#.
# ########.#
# ##...##.#.
# ..###.#.#.

# Tile 2971:
# ..#.#....#
# #...###...
# #.#.###...
# ##.##..#..
# .#####..##
# .#..####.#
# #..#.#..#.
# ..####.###
# ..#.#.###.
# ...#.#.#.#

# Tile 2729:
# ...#.#.#.#
# ####.#....
# ..#.#.....
# ....#..#.#
# .##..##.#.
# .#.####...
# ####.#.#..
# ##.####...
# ##..#.##..
# #.##...##.

# Tile 3079:
# #.#.#####.
# .#..######
# ..#.......
# ######....
# ####.#..#.
# .#...#.##.
# #.#####.##
# ..#.###...
# ..#.......
# ..#.###..."""

input="""Tile 1913:
##..#....#
.#.#.#.###
#...##.##.
.....#.#.#
.#......##
.........#
#...###..#
.#..#.....
.##...#..#
#.#...#...

Tile 2579:
##...####.
##..#....#
...#...#.#
#.....###.
##..#...##
#....#..#.
.#.....###
.##...#...
#.........
...##.....

Tile 1531:
.......###
.#....####
.#.#.#...#
....#..#.#
.#.#.##..#
.#.#.#...#
#.##...###
##..#.....
#...#.....
##.##.#..#

Tile 1493:
#.##.#.#..
#.#..#.##.
..#.....#.
#.#.#....#
....#....#
...#####..
#####.#.#.
#.##..##..
..#.....##
.##..#.###

Tile 3109:
########.#
......#.##
#....#...#
##.#.##...
....#.#...
#####...##
....#....#
..##...###
.......#.#
#.##.#....

Tile 3343:
###......#
#..#.#..##
...#....#.
#.........
..#.....##
.....#####
.....####.
##.......#
..#.......
#.......##

Tile 2609:
####..#.##
#.#..#....
....###..#
###..#..#.
#.#......#
##..#..#..
#....#..#.
#......###
#..#....##
.#..#.###.

Tile 1823:
###..#....
..###...#.
..#.###...
...#.....#
#....#.#.#
.#..#.#..#
#..##.#..#
...##.....
....#.#.#.
###.##...#

Tile 3391:
....#...#.
.#.#....#.
#......#..
#..#....#.
#.##...#.#
...##.####
....##..#.
##.#.#..##
.....#..##
#.#.#..#.#

Tile 2753:
....###..#
.#..##.#.#
...#......
..#.###.##
...#..##..
....#.....
#......#..
#........#
......#..#
#..#.#...#

Tile 3989:
.#.###.#..
#......##.
.##......#
.......###
###....###
##........
##....#.#.
...#.#..#.
........#.
###..#..#.

Tile 1877:
...###...#
#.#..##...
.##.###.#.
#.#....#..
#..#.#.##.
#.......##
####..#.#.
##.#....##
.##.......
.#..##..##

Tile 2729:
#...####.#
...#.....#
.###......
...#..#..#
...#.#.#.#
.#.....##.
..#.....##
........#.
###.......
#..##...##

Tile 1031:
##.#..####
#.##.#....
..#.......
#......###
.##.###.##
#...#...#.
#..##.....
#..#.#.#..
....###...
....#.###.

Tile 3803:
#..#..##..
...##..#..
...#.#....
#.....#..#
#........#
.#..#.#.##
..#..#.#..
#..#.#.#..
..##..#.#.
#####.###.

Tile 3541:
.##.#..#..
.##..#...#
.#.#..#...
...#..##.#
..#.....#.
..##......
.##......#
##.......#
.#..#.##.#
###.#.##.#

Tile 3821:
.#.#.#....
..#..##...
#.##......
..#...#.##
#.####..#.
##.##.#...
..#..#....
....#....#
...###.#.#
.#..#.#.##

Tile 3853:
#####..#.#
.....#..##
#...#.##.#
.##....#.#
#.#......#
###...#.#.
##....#.##
#.#.#.#..#
....###...
##.#.#....

Tile 1249:
###...####
..#....#..
##.##....#
.........#
#.........
.##.#.##..
...#...##.
..........
##...#.#..
##.####..#

Tile 3673:
...##..#.#
.#..#..#.#
###......#
#.....###.
..#.#.....
#.#..#.###
.#.##.##..
.##....#..
.#...##..#
#.###..#.#

Tile 3163:
##.#.#####
.##....#..
####......
#..#.#..##
.#.#..##.#
##.....#.#
.......#..
#...#.....
..#..#....
###.#...#.

Tile 1759:
###.#...##
...#..#...
###..###..
.#.#...#.#
.##...#...
..###....#
#.#.....#.
......###.
..#.####.#
##..##..#.

Tile 1831:
.#...#...#
...#.#..##
#...#.#...
#...##.#..
.#.#.#..#.
......##.#
.........#
#....##.#.
......#..#
#..#...##.

Tile 2179:
.###.....#
..######.#
....#....#
...#....#.
#.##..#...
#..#....##
.#..#.#..#
..#.#....#
#.#.#.....
###.##...#

Tile 2713:
..###.#..#
#.#.....#.
#....#.#..
#...##....
##...#.#.#
###..###.#
.##..#..##
.#...##.#.
#.#.......
#...#.....

Tile 1889:
....#....#
......#.#.
##.###...#
.#..##...#
##.##.#..#
...#...##.
#....#...#
.......#..
.#...#..##
.#.####.##

Tile 1999:
##....##.#
#..#.##.##
..#...#...
#.....#...
......#...
#.....#..#
.#.##..#.#
..#..##..#
#...#..#..
###..##..#

Tile 2039:
.#....####
.##..#....
.#.......#
#........#
#.......#.
.#..#.....
#.##......
##....#..#
.........#
#.#......#

Tile 2969:
...#####..
..#.#...##
##.....#..
##.....###
#...#..###
#..#....##
#..##...##
.........#
#...##...#
.#......##

Tile 2153:
.##..###..
#.#..#..##
.#####....
#.#..#.###
#.....#.##
####..#.#.
..........
.#......#.
...##...#.
.#....####

Tile 2837:
..###.....
###.#.###.
.#....#...
##.....###
##.##..###
..#..##.##
.#....##..
#..##.##..
#..#......
#..##...#.

Tile 1619:
##..###.##
##....####
.#..##.#..
##.#...#..
#..##.##..
...#.#.#.#
.....#.##.
..##..#..#
#..#..#..#
......#.#.

Tile 3943:
.#.##.#.#.
.......#.#
.........#
...#..#..#
...#....##
#.#.##....
##.......#
.#..#.##.#
...##.#..#
#.##....#.

Tile 3389:
#...#.##..
#.##..#...
#.#.#.....
##...#...#
##.....#..
.#..###..#
..###.....
#.##..#.##
####....##
##.#.#####

Tile 3631:
##.###.###
#...#.....
..#.......
#....#.###
#.........
#.#.......
....##...#
........#.
#....#....
.....#.#..

Tile 2081:
##..##.#..
.##......#
........##
#.......##
......##.#
#....#....
.#.#...##.
....##..#.
#.#..#####
...#####..

Tile 1579:
##........
.....#...#
#......#..
#..#.#...#
...#..#...
#.##....##
...#......
.#...#..#.
..#....#.#
.##...#...

Tile 3019:
.##..####.
...#....##
...##.#.#.
#....#....
.........#
##..#..#.#
...#.#...#
.#.##.#.##
##..#.....
#..#..###.

Tile 2089:
##.##.#...
..#.##...#
##...#....
#........#
#..#.....#
..######.#
.......#..
...#..##..
#.#....#..
...#.#####

Tile 2297:
#.#.###...
#.##......
#..#..#...
......#..#
#....#...#
###.#..##.
#....##.##
.......#.#
.........#
.###.#.#..

Tile 1373:
#..#.####.
........#.
....#....#
.##..#...#
.#.....#.#
#.....#...
#..#..#..#
.##...##.#
##.......#
.##..#.#..

Tile 1259:
...#..##.#
....#.#..#
#..#.##.##
##..##....
#..#.#..##
#.#...#...
..#......#
...###.#.#
..........
.###..##..

Tile 2411:
.###..#.#.
.#..#..#..
#.....#..#
.#.....#..
##..#...#.
.#........
#...##....
#.#..##...
.....#.#.#
....#.##..

Tile 3359:
.##..##.##
..#.#..#.#
#.......#.
.#..###..#
.#.....#..
#.........
...#.....#
.##....#..
.........#
.#.##..#..

Tile 2437:
.#.....#..
#.#.......
....##.#..
##.###.##.
##.#....#.
#...#....#
##..##..##
...#..#..#
....##.#.#
.##.#.#...

Tile 1367:
....#####.
..#.#....#
##......#.
..##...##.
..##..##.#
..##.##..#
#.#......#
##...#...#
.....#.#..
##.###.###

Tile 3533:
##..####..
##..#....#
...#.....#
#.##..####
###..##...
....###..#
..#.....##
.##.#..#..
....#.##..
##.#.##.##

Tile 1451:
.####.#...
..##.#.#..
...#.#....
.........#
....#...##
##...##...
..#...#...
#...#.####
...#.#.###
#######...

Tile 3457:
#.##.###.#
#..#.#....
###.#....#
.#....#.##
.......##.
#...####.#
#.#####..#
#.#..#..#.
#.#.......
.#.##.....

Tile 2657:
..#####..#
......###.
#.....#..#
.#..###..#
...#.##...
#.....#..#
#....#####
....#..#..
#.#.###..#
.#..##.#..

Tile 2347:
#.##.#.###
#...#....#
..........
#.#.#.....
#....#....
#..#...###
#.##...#..
#.....#..#
#.#.###.#.
#...###.##

Tile 3923:
#.####...#
###...#.##
......#..#
..#..#..##
#....#.#.#
.........#
.....#.#.#
#..####..#
....##.#..
#..#...#..

Tile 2593:
####...#..
#...####.#
#......##.
..#..#....
#..#.....#
...#......
....#.....
#.#...##.#
.......#.#
#.#####.#.

Tile 1103:
..##...#.#
..#.....#.
#....#...#
...##....#
#.#.....##
.#.#.#.#..
#....#####
.#.#.#####
.........#
.##...#.#.

Tile 2671:
.##.##.#.#
...#.#....
##....#...
#......#..
.#....#.##
........##
..#...###.
###...#...
....#.#..#
.#######.#

Tile 3907:
###....#..
..##.....#
..........
##...#..##
##..#..##.
##..##..#.
#.#.....##
..###..#.#
#..#..#..#
#.#.......

Tile 1327:
.#..#..#.#
.###.###..
..#..#....
.#...#.#..
#.##.....#
#..#.#..#.
###...#...
##..#..#.#
......#...
#.#...###.

Tile 1163:
..#.#...#.
####.#.#..
.##.....##
#...#.....
.....####.
#...#..###
...#.##.#.
##..#..#..
.....#.#.#
.###...#.#

Tile 2683:
.......#..
.#.#.##..#
##..#...##
...#......
##.##...#.
...#.#.###
.#.##.....
#..#....#.
.###..#...
.#.#.....#

Tile 3881:
#.#.#..##.
##.#...###
##......##
#.........
#..#......
...#.#...#
.#..##....
.....##.#.
##...#....
###.....#.

Tile 2711:
#...#.#.##
#..##.....
...#......
#.#.#....#
#...#.#...
...#......
.#.#......
..#....#.#
#.##..#...
#.#.#.....

Tile 3491:
.###..#.##
.....#....
.##..#..##
##.##..#.#
.###....##
..##..#..#
..#......#
..#..#...#
#...#.#..#
.......##.

Tile 2339:
###.#####.
.#....#...
##.#.....#
#.........
#.........
..##..##.#
.###......
#...##....
##........
#.....#..#

Tile 1543:
..##...#..
.....#..##
....##....
.........#
.#..#.#..#
..........
.........#
#.#.#.....
##.#.#....
#.#.###..#

Tile 2371:
#..#.#####
##.#..###.
#.#...##..
#...###.##
#...#..#.#
##.....###
.#.......#
.....#.#..
..#.#.####
.###..##..

Tile 2971:
..###.#...
#.........
##.#...###
....###...
###......#
..###....#
##.#.....#
.#.....#..
#.....####
..##.##.#.

Tile 2203:
#.###.#.##
.#...##.#.
#.#.....#.
..#.#....#
##..#....#
##..#.....
#..#..#...
##........
..#..#.#..
##....#..#

Tile 2113:
###...##.#
......#...
.....##.#.
....####.#
##..#..#..
#...#...##
.......#.#
......#..#
#.##.#..##
....##.#..

Tile 1321:
.#..#..#..
##...#...#
..........
.####..#.#
##.#.#.#.#
#..#.#....
#..#.....#
.#.......#
....###.#.
##.#.##.##

Tile 1667:
.#####...#
##....#..#
#..#.#....
..##..#...
#..##...##
...#......
..#..#...#
.....#...#
#..#...#.#
##..#.##..

Tile 3001:
.#.#######
...#.#...#
..##...#.#
#.........
....#.....
#.....##.#
.....####.
#.........
...#.##.##
##.##..###

Tile 1789:
..###.#..#
...##...#.
........#.
####...#.#
#..#..#...
##.##..##.
....#.....
#.#.#.....
#.#..#...#
######.#..

Tile 3677:
.#...#.###
#..##...##
#..#...#.#
##........
..#....###
..........
##..#.##.#
.#........
......##..
.##.##...#

Tile 2693:
#.#.###.#.
#.#..#..#.
.#....#...
#..#...#.#
.#.##..##.
.##......#
...#.....#
##...#.###
.#.#.....#
########..

Tile 2141:
#####.....
#.........
#...#....#
....#.....
.......#..
##..#.#..#
#....#..#.
..#....#..
.....##.#.
##..#.#.#.

Tile 3847:
#...######
#..#.##..#
..#...##.#
##..#.#..#
##..#..#.#
##.##....#
#........#
#....#.#..
#.........
#......#..

Tile 2333:
#.#..##.#.
####.....#
###..#...#
.........#
...##.#..#
###.......
..##...#.#
...###...#
.###.#...#
##..#.##..

Tile 2129:
#..###.###
....#....#
#.#.#..#.#
....#....#
#...#.#..#
..##.##...
#.##....#.
#...#.#...
.#..##...#
...###.##.

Tile 1283:
.#..#.###.
###.#.##.#
#..#..#.#.
.....#...#
.#.#.#....
#...#..#.#
.#.#..#.##
.#..##..#.
#....##.#.
.#..#...#.

Tile 2851:
.##.#.....
###......#
.#........
....#.#..#
.#..#..#..
.##....#..
.##...#.##
#.###.##.#
##........
.#.#.#.#.#

Tile 2311:
#..##....#
.#......#.
....#...##
....#...#.
.#...#...#
#...#....#
.....#.#.#
.....##..#
##..##.###
##..###.#.

Tile 3217:
#.##....##
#.......#.
#.#....#.#
..##.###..
....##...#
#.........
...#.#...#
..##....##
..#......#
##.###..##

Tile 2833:
####..#..#
#...##.#.#
........##
..##..#...
.......#..
......#...
###..#..#.
.##..#...#
##.#....#.
.####.....

Tile 3593:
#..#####..
.##.#....#
...#..#..#
##.#...##.
#######...
...#..#...
#.##..#.#.
#........#
#...##..##
........##

Tile 3299:
...#.#..#.
#.#......#
##......##
.#..#..#..
#.#####...
#...#....#
#.#.......
..#....#.#
.#........
#.#.#.##..

Tile 2719:
...#..#.#.
#..#.###..
......#.##
....#.#..#
#.#......#
....#.....
##..#.#...
...##.....
###.#....#
..####..##

Tile 2161:
..#.##..##
#........#
...#.#...#
...###....
......#..#
..##.##.#.
.#....#.##
#...#####.
#....#...#
.#....#...

Tile 3643:
...#...##.
##......##
....#.###.
.#.#..####
..#.#...##
.##.#.#.#.
#.#..#..#.
#..#.#..#.
.#........
.#.###....

Tile 3767:
.##.#....#
#...#...##
.#...##..#
.#.#......
..#..#..##
#..#.#.##.
#.....#.##
....##...#
.....#.##.
..#..###..

Tile 2377:
.#####.#.#
..#.....##
#...#...#.
##....##..
....#..#..
#.##..#..#
.#...#.##.
...##...#.
#....#....
..#.#..###

Tile 2441:
....#.###.
.#..#....#
.#.###....
#...#.....
#.#.##....
....##....
....##...#
...#..##..
#...###.##
.##.#.#.#.

Tile 2273:
...#..#.#.
#..#...###
..#....#..
...###.#..
.........#
..##.#..##
###.#....#
#..#.....#
....#...#.
.##..#####

Tile 1231:
....#####.
#.....#.#.
..#....#.#
.###..##.#
#..#....##
#..#.#.#..
..#.###...
##........
..#.....##
##.##..#.#

Tile 2879:
#####.###.
#..#..#..#
...#..#..#
#.........
.#.#.#...#
...#..#..#
#.#..#.###
#.....####
.......#.#
..##.#####

Tile 2473:
.##.###..#
....##.#.#
#..#..#..#
..#.#.#...
#..##.....
.##....#..
....##..##
...#.....#
....#.....
.#####.#..

Tile 3329:
#.#..###..
......###.
.###..##..
...#.##...
#..#.#.###
#.###..##.
##..##...#
..#####..#
.#...#....
#.##.#..#.

Tile 1489:
....#....#
#.##.....#
..#......#
..#...#..#
.#....#..#
#..##...#.
..####.##.
.#..##..##
..#.....#.
##.#.##..#

Tile 3259:
..####.###
##.##..#.#
.#..#..###
#.#.......
.....#.#..
##...#.#..
.....#...#
.#....#...
..#.#....#
######....

Tile 1123:
....#.#.#.
...##.....
...##....#
#.##....##
..#...#..#
.#..#.....
.#......##
.........#
.....#...#
.##.###...

Tile 1381:
.###..#.##
#..##..#..
#.....#..#
#..#..#..#
#....#.#.#
.......#.#
#...#.#..#
##..###..#
..#..##...
..##.#..#.

Tile 2903:
#.###.###.
#..###..#.
##.......#
.#....#...
#..#..##.#
...#...#.#
#.#...##.#
......#..#
##.#..#..#
##.#..##.#

Tile 1049:
#....#.###
####.....#
#.##....#.
.#....##..
.##..#..##
#.#.#..#.#
.##...#..#
...#..#.##
.....#..##
..#.#.###.

Tile 3137:
...#.#.#.#
#.#....#..
..###...#.
..#..##..#
.#.#.##.#.
#.#..##..#
#.....#...
##...##.##
#.#...#...
.##.#.....

Tile 2131:
.#......##
...#...##.
.#.#.#.#.#
..........
...#....#.
#.#.#..#.#
..#.#....#
....##....
....##..#.
##.##..#..

Tile 3733:
.#.#....##
.#..#....#
..###.#..#
.....#...#
...#.....#
###..#....
#...#.####
......#...
..#..#....
.#####.#..

Tile 1973:
.#.#.##...
#.....#..#
#......#..
...#...#.#
..#..#...#
####.#....
....#..#.#
.#.....#.#
....#..#.#
..#..#.#..

Tile 3889:
#.##.#...#
#....##..#
.###..#.##
..#...###.
#....##...
#.##......
#.#..#..#.
...#.#...#
........##
##.#..#.#.

Tile 1129:
#...######
#...#.##.#
###.....#.
#.#..#..#.
.#....#...
..#...#..#
#....#.###
......#.#.
#.#..##.##
.###..#..#

Tile 1549:
.#..##.#..
#.#....###
...#..#...
##....#...
..##...#.#
#.#....###
..#.##.##.
.....#...#
#.##.....#
#..#.##...

Tile 2213:
#...#.#.##
#........#
...##...##
.#..##.#.#
#..##....#
...##...##
##........
....#....#
...#.#.#.#
..#.###..#

Tile 1597:
..###..#..
#......#..
.......#.#
#.#....###
#.###..#.#
##.#.##...
#.##.#..##
.#.#..##..
.##..#...#
##...#####

Tile 1777:
#..#....#.
.........#
..#.....#.
..#......#
.##....#..
#...#...#.
.#..#.....
#.....#..#
.#..##...#
#.#...#...

Tile 2503:
#..###.#..
.#..##.#..
....##....
..#..#....
#....#.#..
#.#....#.#
...#.#....
..##.#....
#.#.#....#
#.######..

Tile 3499:
.####...##
.#.##..#..
#........#
..#......#
##..#...#.
#...##....
#......#..
.#.#....##
...#..#...
.##.#...#.

Tile 1811:
#.###...##
..##...#..
..#.#..###
##.#....#.
.#...#....
##.......#
#....#...#
...##.##..
...#.....#
.####..#..

Tile 3793:
###.####..
##...###.#
...#.###..
#....#....
.....#....
...#.....#
###.####..
#.##.##.##
......#...
#.#.###...

Tile 2341:
.##..#.###
.#........
..####..#.
.#..####.#
#....#...#
......##.#
#.....#...
..........
#..###....
####.#####

Tile 3613:
..#.#.#.#.
#....###..
#......#..
#.#...#.##
#..#.....#
##.#.#.#..
...####..#
##...###.#
#.#.#....#
#..####...

Tile 3701:
..##.####.
#.##...###
.###.#....
#..#.....#
##........
###..#.###
..#...#.#.
.##...#..#
##.......#
###.#...##

Tile 1483:
#####..##.
....#..#.#
...#####.#
#.##...#..
........#.
........##
##..##.###
.###....##
...###..#.
...#.#..#.

Tile 3571:
#.#.##.##.
#......##.
#...#.#...
.#.#....#.
#.#....#..
#.#...#...
##.....#.#
##.#.#...#
#....#...#
#.#..#..##

Tile 2521:
##.##..#.#
......#..#
.#.#.#.##.
#........#
.#.##....#
.#....#.#.
##......#.
#....#....
.#..#...#.
.#..#..###

Tile 3413:
.##.##..#.
#...#..#..
##....#..#
..........
#..#...#..
##..#....#
....#.#...
#.....#...
......#.##
..##.##.#.

Tile 1933:
#..#....##
#...#..###
.#......##
......#..#
..........
##.##..###
.......###
...#...###
.#....#..#
#.#..#.#.#

Tile 1021:
.#..##.#.#
##....#...
.#........
.#.#....##
.#......##
##........
.....#..#.
#....#.#.#
#.........
..#.#.##.#

Tile 3323:
...###.#..
.#..####..
....#.....
#.....##.#
###......#
..########
.#....##.#
....##.##.
#..##....#
#.##.#..#.

Tile 1607:
....####..
##.#...#.#
.......#.#
#.........
..#..####.
..#..#.##.
.###.#...#
##...#....
#.######..
##.#.#.###

Tile 1481:
.###...#..
.#......##
.....#...#
...#...##.
#.###.##..
#......###
#.........
###...###.
.#....##..
#....###.#

Tile 1879:
###.##....
#.#.....##
#.#..#.#.#
.#...#..##
......####
#.###.....
......###.
#..#.#..##
..#......#
.#..#.....

Tile 2927:
###..##.#.
#..#....#.
##..#.....
#.#...####
#.........
..###...##
#.####...#
#.##.##..#
...#......
#....#.##.

Tile 1867:
..#..####.
##.##..#.#
.##......#
###..#....
..#......#
#..##..#.#
#.........
...#..#..#
#......#..
.#....#.#.

Tile 2647:
#####.##.#
...#...#..
#.......##
...#..#..#
..#.###...
...##.....
..#......#
.##.......
#...#.....
##...##.#.

Tile 2207:
#.#####.#.
#..#.#..##
...##....#
..#..#.#.#
#...###..#
.##.#...##
#..##..###
#.........
###.#..#.#
.#....##.#

Tile 1223:
###.....#.
#.....#.##
##.##.#...
#...##...#
#....#....
..#.##....
##....##..
..#..#....
.#.##..#..
###.#.####

Tile 1931:
##.#...###
#...##....
#..#....#.
..##..#...
#...#.....
.........#
###.##....
...##.#..#
.#.#.....#
..#..##.##

Tile 3917:
.##.#..#..
.......##.
#.##....##
...#....##
###....#.#
.##.#...##
###.......
##.....#..
....###.##
....#...#.

Tile 1663:
#.#.....##
.#.##.#..#
....#...#.
#...##...#
#..#......
.#..#.#..#
..#..#..##
...#......
#...##....
.##.######

Tile 3373:
#..###.###
##...#.#..
#..#..#..#
.#....##.#
..###..##.
...#.#...#
#.....#..#
##..#.....
.#..#.#...
.#...###.#

Tile 1319:
.#.#.#.#.#
.....#..##
..#.#.#.#.
.#.##...#.
..##......
...#......
.#........
#..#.....#
#..##....#
.#.##.#..#

Tile 2687:
#...###.#.
##.#...##.
#...#...##
#..##....#
......#.#.
.###.#.#..
##...#..##
......#..#
..........
#.....##.#

Tile 2003:
.######...
.##...###.
....#.....
#.###.#.#.
......#..#
..##.#.#.#
#.##..#.#.
####.#....
#...#.#.##
......##.#

Tile 1453:
###.#.####
...###..#.
.#..#..###
..#......#
#.#..#..##
..#..#.#..
#.#...#.#.
..##..#.#.
#..###....
..#..#..##

Tile 1871:
..#..#####
##..#....#
##.......#
#..#..#..#
#.....#.#.
#..###....
..........
.#........
.#.##.##.#
#.#..#.###

Tile 3709:
.##.#.##..
.#..##...#
.##.......
..##.#....
.........#
....#.....
###.#.##..
.#####....
#####.#...
..#..#####"""

reg1 = re.compile(r"""
                \n\n
                """,re.VERBOSE)

tiles = [a for a in re.split(reg1,input) if len(a)>0]
edges_to_tiles={}
tiles_to_tiles={}
common_edges={}
tile_matrices={}

reg2 = re.compile(r"""
                \s(\d+):\n
                """,re.VERBOSE)

num_tiles = len(tiles)
for tile in tiles:
    tile_id=re.findall(reg2,tile)[0]
    tile_list = tile.strip().splitlines()
    tile_size = len(tile_list[1])
    edges=['','','','']
    arr = []
    for i in range(1,len(tile_list)):
        line=[]
        for char in tile_list[i]:
            if char=='#':
                line.append(1)
            else:
                line.append(0)
        arr.append(line)
    a = np.array(arr)
    tile_matrices[tile_id]=a
    for el in a[0:1,:]:
        for k in el:
            edges[0]=edges[0]+str(k)
    for el in a[:,0:1]:
        for k in el:
            edges[1]=edges[1]+str(k)
    for el in a[a.shape[0]-1:,:]:
        for k in el:
            edges[2]=edges[2]+str(k)
    for el in a[:,a.shape[1]-1:]:
        for k in el:
            edges[3]=edges[3]+str(k)
    for edge in edges[0:4]:
        edges.append(edge[::-1])
    
    for edge in edges:
        if edge in edges_to_tiles.keys():
            for other_tile in edges_to_tiles[edge]:
                if tile_id in tiles_to_tiles.keys():
                    tiles_to_tiles[tile_id].add(other_tile)
                else:
                    tiles_to_tiles[tile_id]=set([other_tile])
                if other_tile in tiles_to_tiles.keys():
                    tiles_to_tiles[other_tile].add(tile_id)
                else:
                    tiles_to_tiles[other_tile]=set([tile_id])

                if tuple([tile_id,other_tile]) in common_edges.keys():
                    common_edges[tuple([tile_id,other_tile])].add(edge)
                    common_edges[tuple([other_tile,tile_id])].add(edge)
                else:
                    common_edges[tuple([tile_id,other_tile])]=set([edge])
                    common_edges[tuple([other_tile,tile_id])]=set([edge])                    
            edges_to_tiles[edge].append(tile_id)
        else:
            edges_to_tiles[edge]=[tile_id]

ans = 1
for corner in sorted(tiles_to_tiles,key=lambda x: len(tiles_to_tiles[x]))[0:4]:
    ans*=int(corner)

ordered_tiles=[]
placed_tiles=set()
first_row=[]
current_tile = sorted(tiles_to_tiles,key=lambda x: len(tiles_to_tiles[x]))[0]
first_row.append(current_tile)
placed_tiles.add(current_tile)
m = math.sqrt(num_tiles)
while len(first_row)<m:
    next_tile_options = [k for k in tiles_to_tiles[current_tile] if k not in placed_tiles and k!=current_tile]
    least_paths = 1000
    next_tile=0
    for tile in next_tile_options:
        if len(tiles_to_tiles[tile])-1<least_paths:
            least_paths=len(tiles_to_tiles[tile])-1
            next_tile=tile
    current_tile=next_tile
    placed_tiles.add(next_tile)
    first_row.append(next_tile) 

ordered_tiles.append(first_row)

current_row=[]
i=0
j=0
while len(current_row)<m and len(ordered_tiles)<m:
    tile_options = [k for k in tiles_to_tiles[ordered_tiles[i][j]] if k not in placed_tiles]
    next_tile=tile_options[0]
    current_row.append(next_tile)
    placed_tiles.add(next_tile)
    if len(current_row)==m:
        ordered_tiles.append(current_row.copy())
        current_row.clear()
        i+=1
        j=0
    else:
        j+=1


def orient_right(tile,edge):
    cols = np.shape(tile)[1]-1
    i=0
    found_orientation=False
    while i<4 and not found_orientation:
        if ''.join(str(a) for a in tile[:,cols]) == edge:
            return tile
            found_orientation=True
        else:
            tile = np.rot90(tile)
            i+=1
    tile = np.flipud(tile)
    i=0
    while i<4 and not found_orientation:
        if ''.join(str(a) for a in tile[:,cols]) == edge:
            return tile
            found_orientation=True
        else:
            tile = np.rot90(tile)
            i+=1

def orient_left(tile,edge):
    i=0
    found_orientation=False
    while i<4 and not found_orientation:
        if ''.join(str(a) for a in tile[:,0]) == edge:
            return tile
            found_orientation=True
        else:
            tile = np.rot90(tile)
            i+=1
    tile = np.flipud(tile)
    i=0
    while i<4 and not found_orientation:
        if ''.join(str(a) for a in tile[:,0]) == edge:
            return tile
            found_orientation=True
        else:
            tile = np.rot90(tile)
            i+=1

def strip_right_border(tile):
    shape = np.shape(tile)
    rows = shape[0]
    cols = shape[1]
    return tile[:,0:cols-1]

def strip_left_border(tile):
    shape = np.shape(tile)
    rows = shape[0]
    cols = shape[1]
    return tile[:,1:cols]

def strip_top_border(row):
    shape = np.shape(row)
    rows = shape[0]
    cols = shape[1]
    return row[1:rows,:]

def strip_bottom_border(row):
    shape = np.shape(row)
    rows = shape[0]
    cols = shape[1]
    return row[:rows-1,:]

joined_rows=[]

for row in ordered_tiles:
    tid1 = row[0]
    tid2 = row[1]
    common = list(common_edges[tuple([tid1,tid2])])
    t1 = orient_right(tile_matrices[tid1],common[0])
    t1 = strip_right_border(t1)
    t1 = strip_left_border(t1)
    t2 = orient_left(tile_matrices[tid2],common[0])
    t2 = strip_left_border(t2)
    joined_array = np.concatenate((t1,t2),axis=1)
    i=2
    while i<len(row):
        t = tile_matrices[row[i]]
        edge = ''.join([str(a) for a in joined_array[:,np.shape(joined_array)[1]-1]])
        t = orient_left(t,edge)
        t = strip_left_border(t)
        joined_array = strip_right_border(joined_array)
        joined_array = np.concatenate((joined_array,t),axis=1)
        i+=1
    joined_array = strip_right_border(joined_array)
    joined_rows.append(joined_array)
    # print(joined_array)

# for el in joined_rows:
#     print(el)

full_puzzle = joined_rows[0]
for i in range(1,len(joined_rows)):
    if ''.join([str(a) for a in full_puzzle[np.shape(full_puzzle)[0]-1,:]]) == ''.join([str(b) for b in joined_rows[i][0,:]]):
        full_puzzle = strip_bottom_border(full_puzzle)
        joined_rows[i] = strip_top_border(joined_rows[i])
        full_puzzle = np.concatenate((full_puzzle,joined_rows[i]),axis=0)
    else:
        joined_rows[i]=np.flipud(joined_rows[i])
        if ''.join([str(a) for a in full_puzzle[np.shape(full_puzzle)[0]-1,:]]) == ''.join([str(b) for b in joined_rows[i][0,:]]):
            full_puzzle = strip_bottom_border(full_puzzle)
            joined_rows[i] = strip_top_border(joined_rows[i])
            full_puzzle = np.concatenate((full_puzzle,joined_rows[i]),axis=0)
        else:
            full_puzzle = np.flipud(full_puzzle)
            if ''.join([str(a) for a in full_puzzle[np.shape(full_puzzle)[0]-1,:]]) == ''.join([str(b) for b in joined_rows[i][0,:]]):
                full_puzzle = strip_bottom_border(full_puzzle)
                joined_rows[i] = strip_top_border(joined_rows[i])
                full_puzzle = np.concatenate((full_puzzle,joined_rows[i]),axis=0)
            else:
                joined_rows[i]=np.flipud(joined_rows[i])
                full_puzzle = strip_bottom_border(full_puzzle)
                joined_rows[i] = strip_top_border(joined_rows[i])
                full_puzzle = np.concatenate((full_puzzle,joined_rows[i]),axis=0)

full_puzzle = strip_bottom_border(full_puzzle)
full_puzzle = strip_top_border(full_puzzle)

def convert_to_clean_string(p):
    puzzle_string=np.array2string(p,separator='')
    clean_puz_reg = re.compile(r'[\[|\]| ]*')
    clean_puzzle_string = re.sub(clean_puz_reg,'',puzzle_string)
    return clean_puzzle_string

monster_pattern = re.compile(r"""
                            ^.*1.{1,1}
                            \n
                            1.{4,4}11.{4,4}11.{4,4}111
                            \n
                            .1.{2,2}1.{2,2}1.{2,2}1.{2,2}1.{2,2}1.{3,3}$
                            """,re.VERBOSE)

def has_monster(p):
    clean_p = convert_to_clean_string(p)
    if len(re.findall(monster_pattern,clean_p))>0:
        return 1
    else:
        return 0

def count_monsters(p):
    rows = np.shape(p)[0]
    cols = np.shape(p)[1]
    i=3
    j=20
    ans=0
    while i<=rows and j<=cols:
        box = p[i-3:i,j-20:j]
        ans += has_monster(box)
        if j==cols:
            j=20
            i+=1
        else:
            j+=1
    return ans


monster_count=0
k=0
while monster_count==0 and k<4:
    monster_count += count_monsters(full_puzzle)
    full_puzzle=np.rot90(full_puzzle)
    k+=1

if monster_count==0:
    full_puzzle = np.flipud(full_puzzle)

while monster_count==0 and k<8:
    monster_count += count_monsters(full_puzzle)
    full_puzzle=np.rot90(full_puzzle)
    k+=1

total_hashes = np.nansum(full_puzzle)
hashes_per_monster = 15
ans = total_hashes - (monster_count*hashes_per_monster)
print(ans)